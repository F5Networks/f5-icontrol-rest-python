sudo: true
env:
  global:
  - DIST_REPO="f5-icontrol-rest-dist"
services:
  - docker
language: python
matrix:
  include:
    - python: 2.7
      env: TOXENV=py27-unit
    - python: 3.4
      env: TOXENV=py34-unit
    - python: 3.5
      env: TOXENV=py35-unit
    - env: TOXENV=flake
before_install:
  - git config --global user.email "OpenStack_TravisCI@f5.com"
  - git config --global user.name "Travis F5 Openstack"
install:
  - pip install -r requirements.test.txt
  - pip install -r requirements.docs.txt
script:
  - tox
  - if [[ $TRAVIS_PYTHON_VERSION == 2.7 ]]; then ${DIST_REPO}/scripts/package.sh "redhat" "7"; fi
  - if [[ $TRAVIS_PYTHON_VERSION == 2.7 ]]; then ${DIST_REPO}/scripts/package.sh "ubuntu" "14.04"; fi
  - if [[ $TRAVIS_PYTHON_VERSION == 2.7 ]]; then sudo chown -R travis:travis ${DIST_REPO}/rpms/build; fi
  - if [[ $TRAVIS_PYTHON_VERSION == 2.7 ]]; then sudo chown  travis:travis ${DIST_REPO}/deb_dist/*.deb; fi
before_deploy: PKG_VERSION=$(python -c "import icontrol; print(icontrol.__version__)")
deploy:
  - provider: releases
    api_key:
      secure: "4efz0WaEiHvWwqHJZvIeoXQL8ZGSqJeB8/8lv0G4aYvDzw70I4m5orjWGk8I92dgXtIByFUP58jUja+j1T5Y6WTFYNVCD4Hr6c8xNtsmDoReoHJQOGC0IgBavT7E47qAZjQqVw5n7TMjZmIRjeHg7fA/NjbFLSkIHqxLD+91+D5DY7A7M9FZfHAfzlomORPoZzcbkUsptH5RAOwrQGYcazraAMVJIzMkilhH11Vkn/bLHmqkMQ/4fFu4R9+Kf334MaLnziyUrS1SzHPRMQojPQL0c5RUnw3PFl6M8JlZzQytHoQcnaR+bVbXhDEXnMRH2BrSiXpcVivV8VBQsTOuqujeZ5mUtFK//gT2Y6z5nteekgxxz3xMwnH6TYxPOOnbf4EYtOuAGMZ91VYrTDiSGmC3CHHmGRmUgoWbsPTup2hHv6zYHu5a4MNsocMYfuqpDM22xkLVL3EZy6iQWi9p32O90xIIh9Nyohq3nUuFG0IhvVuwm7mdmb49Ds17SB9VcIDQkkbwxKW56fiIWRjK8XeVPIFH2S5iWdWj1PBResAHamuoiyg2D5I7DV5IyYbFVVDXOAZLik4McN11zyTXUmp6LyG431sZmpDMVZ6WIJMbpPoC7hheZVrK0YITCeYO8HAnTMZOR43df6uzG6q28rZmMClRNyjH+ymSKqFyruM="
    file:
      - ${DIST_REPO}/rpms/build/f5-icontrol-rest-${PKG_VERSION}-1.el7.noarch.rpm
      - ${DIST_REPO}/deb_dist/python-f5-icontrol-rest_${PKG_VERSION}-1_1404_all.deb
    skip_cleanup: true
    overwrite: true
    on:
      repo: F5Networks/f5-icontrol-rest-python
      tags: true
      python: 2.7
notifications:
  slack:
    rooms:
      - f5openstackdev:$SLACK_PROJECT_TOKEN
      - f5openstackdev:$SLACK_BUILD_STATUS_TOKEN
    on_success: change
    on_failure: always
